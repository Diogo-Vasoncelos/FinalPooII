{% extends "base.html" %}

{% block title %}Cadastro - Sistema de Pedidos{% endblock %}

{% block content %}
<div class="container py-5">
    <div style="max-width: 700px; margin: 0 auto;">
        <div class="card">
            <div class="card-header text-center">
                <h2 class="card-title">游닇 Criar Conta</h2>
                <p class="text-secondary">Preencha seus dados para se cadastrar</p>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('cadastro') }}" id="cadastroForm" novalidate>
                    <!-- Nome Completo -->
                    <div class="form-group">
                        <label for="nome" class="form-label">Nome Completo *</label>
                        <input 
                            type="text" 
                            id="nome" 
                            name="nome" 
                            class="form-input" 
                            placeholder="Jo칚o da Silva"
                            required
                        >
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="email" class="form-label">Email *</label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            class="form-input" 
                            placeholder="seu@email.com"
                            required
                        >
                    </div>

                    <!-- CPF e Telefone (Grid) -->
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label for="cpf" class="form-label">CPF *</label>
                            <input 
                                type="text" 
                                id="cpf" 
                                name="cpf" 
                                class="form-input" 
                                placeholder="000.000.000-00"
                                maxlength="14"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label for="telefone" class="form-label">Telefone *</label>
                            <input 
                                type="text" 
                                id="telefone" 
                                name="telefone" 
                                class="form-input" 
                                placeholder="(00) 00000-0000"
                                maxlength="15"
                                required
                            >
                        </div>
                    </div>

                    <!-- Idade -->
                    <div class="form-group">
                        <label for="idade" class="form-label">Idade *</label>
                        <input 
                            type="number" 
                            id="idade" 
                            name="idade" 
                            class="form-input" 
                            placeholder="18"
                            min="18"
                            max="150"
                            required
                        >
                    </div>

                    <!-- Endere칞o -->
                    <div class="form-group">
                        <label for="endereco" class="form-label">Endere칞o Completo *</label>
                        <textarea 
                            id="endereco" 
                            name="endereco" 
                            class="form-textarea" 
                            placeholder="Rua, n칰mero, bairro, cidade - UF"
                            required
                        ></textarea>
                    </div>

                    <!-- Senha -->
                    <div class="form-group">
                        <label for="senha" class="form-label">Senha *</label>
                        <input 
                            type="password" 
                            id="senha" 
                            name="senha" 
                            class="form-input" 
                            placeholder="M칤nimo 6 caracteres"
                            minlength="6"
                            required
                        >
                    </div>

                    <!-- Bot칚o Submit -->
                    <button type="submit" class="btn btn-primary btn-full">
                        Cadastrar
                    </button>
                </form>

                <!-- Link para Login -->
                <div class="text-center mt-3">
                    <p class="text-secondary">
                        J치 tem uma conta? 
                        <a href="{{ url_for('login') }}" class="text-primary" style="font-weight: 500;">
                            Fa칞a login aqui
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// ==================== VALIDA칂칏ES EM TEMPO REAL ====================

// Campos do formul치rio
const camposValidacao = {
    'nome': 'nome',
    'email': 'email',
    'cpf': 'cpf',
    'telefone': 'telefone',
    'idade': 'idade',
    'endereco': 'endereco',
    'senha': 'senha'
};

// Adiciona listeners para valida칞칚o em tempo real
Object.keys(camposValidacao).forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field) {
        // Valida칞칚o ao sair do campo (blur)
        field.addEventListener('blur', function() {
            validarCampo(fieldId, camposValidacao[fieldId]);
        });
        
        // Limpa erro ao digitar
        field.addEventListener('input', function() {
            limparErro(fieldId);
        });
    }
});

// Formata칞칚o autom치tica de CPF
document.getElementById('cpf').addEventListener('input', function(e) {
    let value = e.target.value.replace(/[^\d]/g, '');
    if (value.length > 11) value = value.substr(0, 11);
    
    // Estrutura de decis칚o: aplica formata칞칚o baseada no tamanho
    if (value.length > 9) {
        e.target.value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/, '$1.$2.$3-$4');
    } else if (value.length > 6) {
        e.target.value = value.replace(/(\d{3})(\d{3})(\d{0,3})/, '$1.$2.$3');
    } else if (value.length > 3) {
        e.target.value = value.replace(/(\d{3})(\d{0,3})/, '$1.$2');
    } else {
        e.target.value = value;
    }
});

// Formata칞칚o autom치tica de Telefone
document.getElementById('telefone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/[^\d]/g, '');
    if (value.length > 11) value = value.substr(0, 11);
    
    // Estrutura de decis칚o: aplica formata칞칚o baseada no tamanho
    if (value.length > 10) {
        e.target.value = value.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
    } else if (value.length > 6) {
        e.target.value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
    } else if (value.length > 2) {
        e.target.value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
    } else {
        e.target.value = value;
    }
});

// ==================== VALIDA칂츾O NO SUBMIT ====================

document.getElementById('cadastroForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    let formValido = true;
    
    // Valida todos os campos usando estrutura de decis칚o
    Object.keys(camposValidacao).forEach(fieldId => {
        const isValid = validarCampo(fieldId, camposValidacao[fieldId]);
        if (!isValid) {
            formValido = false;
        }
    });
    
    // Estrutura de decis칚o: submete apenas se todos os campos forem v치lidos
    if (formValido) {
        this.submit();
    } else {
        // Exibe alerta de erro
        window.scrollTo({ top: 0, behavior: 'smooth' });
        alert('Por favor, corrija os erros no formul치rio antes de continuar.');
    }
});
</script>
{% endblock %}
